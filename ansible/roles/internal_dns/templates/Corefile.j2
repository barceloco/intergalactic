{{ internal_dns_domain }}:53 {
    # Serve only specific private hosts authoritatively using template
    # This allows www.exnada.com and other external subdomains to be forwarded upstream
    # Each host resolves to its own Tailscale IP (not all to rigel's IP)
{% for host in internal_dns_private_hosts %}
    template IN A {{ host }}.{{ internal_dns_domain }} {
        answer "{{ host }}.{{ internal_dns_domain }} 3600 IN A {{ (internal_dns_host_ips[host] | default('') | length > 0) | ternary(internal_dns_host_ips[host], tailscale_ip) }}"
    }
{% endfor %}
    # Cache responses with configurable TTL
    cache {
        success {{ internal_dns_cache_ttl | default(3600) }}
        denial {{ internal_dns_cache_ttl | default(3600) }}
    }
    # Prevent forwarding loops
    loop
    # Forward all other queries (including www.exnada.com) upstream
    forward . {{ internal_dns_upstream_servers | join(' ') }}
    log
    errors
}

# Health, ready, prometheus, and reload endpoints are disabled
# They require separate server blocks which cause zone parsing errors
# Use docker healthchecks or external monitoring instead
